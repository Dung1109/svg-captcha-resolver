package com.example.demo;

import com.example.demo.solver.CaptchaSolver;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.CommandLineRunner;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.core.ParameterizedTypeReference;
import org.springframework.http.ResponseEntity;
import org.springframework.web.client.RestClient;


@SpringBootApplication
public class Demo1Application implements CommandLineRunner {

    @Autowired
    RestClient restClient;


    public static void main(String[] args) {
        SpringApplication.run(Demo1Application.class, args);
    }

    @Override
    public void run(String... args) throws Exception {
        String sampleSvg = "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"200\" height=\"40\" viewBox=\"0,0,200,40\"><path fill=\"#444\" d=\"M24.31 34.93L24.40 35.01L24.40 35.02Q20.13 34.37 18.31 32.92L18.37 32.98L18.26 32.88Q16.52 31.52 16.11 28.51L16.04 28.45L16.09 28.50Q16.11 28.17 15.76 23.41L15.59 23.24L15.65 23.29Q15.80 22.23 15.73 20.97L15.67 20.92L15.73 20.98Q15.46 15.83 17.67 14.08L17.75 14.17L17.70 14.11Q20.39 12.04 28.15 11.36L28.14 11.34L28.19 11.39Q29.41 11.13 31.05 11.17L31.08 11.20L31.18 11.30Q31.10 11.22 34.07 11.22L34.08 11.23L34.08 11.23Q34.85 11.17 36.56 11.32L36.60 11.35L36.64 11.40Q36.18 12.38 35.15 15.46L34.98 15.30L35.03 15.34Q33.00 14.19 29.99 14.19L29.98 14.17L30.06 14.26Q29.13 14.08 28.33 14.16L28.37 14.21L28.41 14.24Q23.39 14.78 20.88 16.76L20.74 16.62L20.87 16.75Q18.88 18.37 18.72 21.72L18.65 21.65L18.61 21.61Q18.65 22.30 18.69 23.55L18.56 23.43L18.67 23.54Q18.69 28.28 21.09 30.37L21.12 30.40L21.05 30.33Q23.32 32.38 28.31 32.68L28.33 32.71L28.37 32.74Q31.44 32.84 34.45 31.05L34.46 31.06L34.53 31.13Q35.13 33.87 35.74 35.24L35.73 35.23L35.58 35.08Q33.53 35.39 31.89 35.35L32.00 35.46L31.84 35.30Q27.50 35.37 24.38 34.99ZM39.50 38.74L39.39 38.62L39.50 38.73Q37.64 35.66 36.96 33.07L36.90 33.01L36.98 33.09Q36.60 33.40 35.61 33.78L35.53 33.70L35.53 33.70Q35.18 32.89 34.99 32.05L34.92 31.98L34.66 30.39L34.53 30.26Q31.42 32.48 28.29 32.36L28.30 32.37L28.13 32.20Q24.03 32.17 21.71 30.42L21.57 30.28L21.70 30.41Q20.41 28.44 20.49 25.51L20.53 25.54L20.59 25.61Q20.67 21.05 23.14 18.91L23.17 18.94L23.17 18.94Q25.27 17.00 29.95 16.39L30.06 16.50L30.10 16.54Q30.79 16.31 31.51 16.31L31.57 16.38L31.47 16.28Q34.31 16.34 36.40 17.86L36.36 17.81L36.48 17.94Q36.88 15.71 38.10 12.47L38.13 12.50L38.09 12.47Q37.83 12.47 37.28 12.41L37.35 12.48L37.21 12.35Q36.75 12.38 36.48 12.38L36.52 12.41L36.44 12.34Q36.72 11.90 37.18 10.91L37.11 10.83L37.10 10.82Q36.97 10.92 34.47 10.85L34.40 10.77L34.32 10.69Q31.89 10.68 31.24 10.72L31.36 10.83L31.18 10.66Q20.76 11.09 17.30 13.68L17.33 13.71L17.25 13.63Q15.28 15.51 15.28 19.43L15.21 19.35L15.24 19.38Q15.32 20.57 15.43 23.27L15.35 23.18L15.41 23.25Q15.43 26.69 15.66 28.40L15.67 28.41L15.66 28.41Q16.03 31.52 17.63 33.05L17.69 33.11L17.62 33.04Q18.31 33.91 19.57 35.05L19.50 34.99L19.48 34.97Q22.71 36.71 27.96 37.47L28.05 37.56L27.99 37.50Q34.48 38.51 39.47 38.70Z\"/><path d=\"M17 31 C114 25,110 29,182 13\" stroke=\"#888\" fill=\"none\"/><path fill=\"#333\" d=\"M107.55 14.43L107.52 14.40L107.49 14.37Q108.35 18.62 108.51 22.20L108.55 22.24L108.56 22.25Q109.49 22.15 110.55 22.15L110.55 22.15L112.91 22.30L112.78 22.17Q113.83 22.15 114.71 20.74L114.72 20.76L114.79 20.83Q115.47 19.61 115.59 18.43L115.69 18.54L115.56 18.40Q115.99 15.45 111.77 14.95L111.81 14.99L111.85 15.03Q110.03 14.86 107.41 14.28ZM108.61 25.05L108.54 24.98L108.60 25.03Q108.47 31.19 107.33 35.60L107.28 35.55L107.25 35.52Q105.80 35.93 103.47 37.00L103.46 36.99L103.54 37.07Q105.82 30.32 105.55 23.05L105.61 23.11L105.59 23.08Q105.39 15.81 102.61 9.37L102.44 9.20L102.55 9.32Q106.73 12.12 112.97 12.12L112.97 12.12L112.84 11.99Q118.89 11.99 119.05 15.45L119.13 15.54L119.11 15.52Q119.29 18.06 118.30 20.72L118.16 20.59L118.16 20.58Q117.76 21.71 116.81 22.93L116.95 23.07L116.90 23.01Q115.49 24.54 112.94 24.80L113.02 24.88L113.08 24.94Q110.67 24.81 108.42 24.85ZM114.58 27.13L114.67 27.22L114.62 27.17Q118.87 27.50 120.13 22.70L120.02 22.60L120.10 22.68Q120.96 18.93 120.81 16.91L120.81 16.91L120.86 16.96Q120.69 15.38 119.93 14.39L120.01 14.47L119.89 14.35Q119.59 14.06 119.09 13.83L119.16 13.89L119.11 13.84Q119.23 13.81 118.62 13.05L118.59 13.02L118.51 12.94Q116.89 11.55 112.93 11.55L112.96 11.57L112.98 11.59Q106.18 11.69 101.96 8.53L101.86 8.43L101.88 8.45Q105.02 15.51 105.29 22.98L105.25 22.94L105.24 22.93Q105.54 30.61 102.88 37.70L102.97 37.79L102.89 37.71Q103.99 37.09 104.98 36.71L105.09 36.83L104.68 37.94L104.60 37.85Q104.37 38.39 104.10 38.96L104.09 38.95L104.12 38.97Q106.60 37.99 109.49 37.46L109.47 37.44L109.44 37.41Q110.42 32.03 110.50 27.31L110.49 27.31L110.49 27.30Q111.54 27.17 112.53 27.17L112.49 27.13L112.45 27.09Q113.87 27.18 114.67 27.22ZM113.61 17.17L113.79 17.36L113.65 17.22Q114.12 17.19 115.11 17.42L115.22 17.53L115.25 17.56Q115.28 17.70 115.31 18.00L115.41 18.10L115.36 18.05Q115.44 18.35 115.36 18.62L115.37 18.63L115.23 18.49Q115.14 19.74 114.42 20.61L114.41 20.60L114.47 20.66Q113.80 21.63 112.77 21.82L112.85 21.90L112.80 21.85Q112.17 21.94 110.53 21.94L110.56 21.96L110.45 21.86Q110.43 19.59 110.20 17.23L110.13 17.16L111.93 17.28L111.94 17.29Q112.86 17.37 113.73 17.30Z\"/><path fill=\"#222\" d=\"M175.40 35.35L175.47 35.43L175.38 35.33Q172.38 31.42 169.75 22.78L169.87 22.89L169.81 22.84Q169.06 20.61 168.26 18.47L168.43 18.64L165.51 27.36L165.39 27.25Q163.71 32.31 161.31 35.55L161.33 35.56L161.33 35.56Q160.49 35.64 158.85 35.79L158.85 35.79L158.73 35.66Q158.87 34.51 158.87 33.25L158.90 33.29L158.80 33.19Q158.93 27.30 156.19 21.17L156.18 21.16L156.10 21.08Q152.96 14.17 147.09 9.18L147.18 9.27L147.25 9.34Q149.26 9.90 151.62 10.43L151.76 10.58L151.76 10.57Q160.29 18.88 161.59 29.84L161.69 29.94L161.67 29.92Q163.37 26.67 164.82 21.31L164.79 21.28L164.74 21.23Q166.61 13.62 167.10 12.21L167.28 12.39L169.47 12.34L169.52 12.39Q170.23 14.43 170.88 16.75L170.73 16.60L172.00 21.07L171.95 21.02Q173.52 26.47 174.93 29.71L174.91 29.69L175.01 29.79Q176.60 18.09 184.52 10.74L184.63 10.85L184.55 10.78Q186.10 10.46 189.07 9.81L189.09 9.83L189.15 9.89Q183.84 14.22 180.80 20.35L180.69 20.24L180.63 20.18Q177.56 26.44 177.56 33.21L177.70 33.35L177.54 33.20Q177.55 34.31 177.63 35.45L177.75 35.58L176.65 35.50L176.50 35.35Q175.91 35.30 175.34 35.30ZM181.69 38.29L181.65 38.26L181.64 38.24Q180.32 34.60 180.44 30.72L180.50 30.79L180.53 30.81Q180.88 19.29 190.25 11.03L190.18 10.96L190.20 10.98Q189.25 11.21 187.31 11.75L187.34 11.77L187.34 11.77Q188.20 10.85 190.11 9.06L190.16 9.11L190.18 9.14Q187.54 9.92 184.61 10.41L184.51 10.31L184.52 10.33Q177.02 17.45 175.12 26.93L175.15 26.96L175.21 27.02Q174.62 25.36 171.76 13.90L171.72 13.86L171.84 13.98Q171.26 13.90 170.31 13.90L170.37 13.95L170.14 12.96L170.18 13.00Q169.92 12.33 169.69 11.83L169.75 11.89L166.76 11.80L166.92 11.95Q165.93 14.24 164.66 19.36L164.67 19.38L164.85 19.55Q163.52 24.62 162.53 27.09L162.58 27.14L162.47 27.03Q160.88 19.12 155.32 12.80L155.43 12.92L155.30 12.78Q154.83 12.73 153.88 12.54L153.98 12.65L153.87 12.53Q153.25 11.79 151.69 10.16L151.73 10.20L151.58 10.05Q148.27 9.33 146.10 8.53L146.03 8.46L146.09 8.52Q151.84 13.28 155.11 19.48L154.93 19.30L155.11 19.48Q158.49 26.02 158.49 33.03L158.46 32.99L158.53 33.06Q158.46 34.55 158.27 36.15L158.31 36.19L158.33 36.22Q158.44 36.09 158.89 36.00L159.06 36.17L158.95 36.05Q159.44 36.00 159.67 36.00L159.71 36.04L159.57 36.92L159.70 37.05Q159.59 37.40 159.67 37.94L159.84 38.10L159.72 37.99Q160.80 37.85 163.09 37.70L163.22 37.83L163.21 37.82Q166.81 32.40 169.55 23.00L169.46 22.91L169.52 22.97Q172.31 31.77 175.28 35.73L175.35 35.80L175.20 35.65Q175.80 35.79 176.64 35.91L176.65 35.92L176.55 35.82Q177.45 36.91 178.52 37.98L178.48 37.94L178.46 37.92Q179.35 38.09 181.75 38.35Z\"/><path fill=\"#333\" d=\"M52.52 34.85L52.53 34.86L52.57 34.90Q48.33 34.28 46.50 32.83L46.52 32.85L46.56 32.89Q44.67 31.37 44.25 28.37L44.36 28.48L44.31 28.43Q44.27 28.05 43.93 23.29L43.92 23.28L43.99 23.35Q43.98 22.12 43.90 20.87L43.90 20.86L43.90 20.86Q43.84 15.93 46.04 14.17L45.91 14.04L45.90 14.03Q48.53 11.91 56.30 11.22L56.36 11.28L56.45 11.37Q57.71 11.14 59.34 11.18L59.44 11.27L59.41 11.24Q59.33 11.17 62.30 11.17L62.33 11.19L62.24 11.11Q63.19 11.22 64.90 11.37L64.93 11.40L64.86 11.33Q64.34 12.25 63.31 15.33L63.30 15.33L63.37 15.40Q61.22 14.12 58.21 14.12L58.20 14.11L58.22 14.13Q57.59 14.26 56.79 14.34L56.76 14.31L56.80 14.34Q51.57 14.68 49.06 16.66L49.11 16.71L49.04 16.64Q47.13 18.34 46.97 21.69L46.85 21.56L46.90 21.62Q46.94 22.30 46.98 23.56L46.96 23.55L46.97 23.55Q47.04 28.35 49.44 30.44L49.46 30.46L49.41 30.40Q51.63 32.40 56.61 32.70L56.55 32.64L56.54 32.62Q59.68 32.80 62.69 31.01L62.67 31.00L62.77 31.09Q63.25 33.70 63.85 35.07L64.01 35.22L63.98 35.19Q61.80 35.38 60.17 35.34L60.12 35.29L60.26 35.43Q55.79 35.38 52.67 35.00ZM67.62 38.57L67.77 38.72L67.66 38.60Q65.82 35.55 65.13 32.96L65.22 33.05L65.15 32.98Q64.87 33.38 63.88 33.76L63.91 33.80L63.78 33.67Q63.48 32.90 63.28 32.06L63.24 32.02L62.90 30.35L62.94 30.38Q59.70 32.48 56.58 32.36L56.45 32.24L56.45 32.23Q52.25 32.11 49.93 30.36L49.96 30.39L49.90 30.32Q48.77 28.51 48.84 25.58L48.79 25.52L48.80 25.53Q49.11 21.20 51.59 19.07L51.52 19.00L51.56 19.04Q53.56 17.01 58.25 16.40L58.34 16.49L58.35 16.50Q59.09 16.33 59.81 16.33L59.89 16.41L59.79 16.31Q62.53 16.27 64.63 17.80L64.66 17.83L64.76 17.93Q65.27 15.81 66.49 12.58L66.33 12.42L66.43 12.51Q66.08 12.44 65.53 12.38L65.55 12.40L65.62 12.47Q65.00 12.35 64.74 12.35L64.79 12.40L64.85 12.46Q64.91 11.79 65.36 10.80L65.38 10.82L65.49 10.93Q65.15 10.82 62.66 10.74L62.61 10.69L62.75 10.84Q60.21 10.72 59.56 10.75L59.49 10.68L59.58 10.76Q49.14 11.18 45.68 13.77L45.51 13.60L45.51 13.60Q43.49 15.42 43.49 19.34L43.62 19.48L43.55 19.41Q43.50 20.46 43.61 23.16L43.76 23.31L43.61 23.17Q43.77 26.75 44.00 28.46L44.01 28.47L44.06 28.52Q44.37 31.58 45.97 33.10L46.00 33.13L45.92 33.05Q46.44 33.76 47.70 34.90L47.74 34.94L47.82 35.03Q50.96 36.68 56.22 37.44L56.23 37.46L56.29 37.51Q62.72 38.47 67.71 38.66Z\"/><path d=\"M14 23 C113 21,96 26,190 18\" stroke=\"#555\" fill=\"none\"/><path fill=\"#111\" d=\"M82.92 25.48L82.85 25.41L82.88 25.45Q79.31 31.70 75.88 35.65L75.88 35.66L75.98 35.75Q74.04 36.10 71.61 36.98L71.60 36.97L71.67 37.04Q76.55 31.41 81.31 23.00L81.39 23.08L81.40 23.09Q76.79 16.12 70.81 9.72L70.76 9.67L70.76 9.67Q73.71 10.91 76.00 11.41L75.95 11.36L76.05 11.46Q80.50 16.48 82.94 20.44L83.06 20.56L83.12 20.62Q85.52 16.10 89.45 11.68L89.44 11.68L89.42 11.66Q91.06 11.40 94.26 10.63L94.17 10.55L94.23 10.60Q88.25 17.15 84.79 23.09L84.79 23.10L84.68 22.98Q89.83 31.64 94.21 36.21L94.16 36.16L94.20 36.20Q91.77 35.55 89.67 35.32L89.48 35.13L89.53 35.18Q86.89 32.35 82.97 25.54ZM89.60 35.67L89.41 35.48L89.51 35.58Q89.82 35.62 90.27 35.73L90.18 35.64L90.31 35.77Q90.99 36.41 92.51 38.01L92.55 38.04L92.65 38.15Q95.92 38.87 98.97 40.24L99.01 40.29L98.94 40.21Q91.86 33.66 86.75 24.90L86.64 24.79L86.80 24.96Q90.49 18.24 96.39 11.39L96.46 11.46L96.33 11.34Q94.89 11.99 92.72 12.52L92.75 12.55L92.72 12.52Q93.74 11.76 95.49 9.97L95.40 9.87L95.46 9.94Q92.93 10.67 89.24 11.25L89.35 11.36L89.33 11.34Q85.82 15.07 83.24 19.37L83.33 19.46L83.24 19.37Q82.39 17.84 81.21 16.36L81.26 16.41L78.87 13.37L78.63 13.50L78.46 13.34Q78.46 13.48 78.23 13.41L78.11 13.30L78.20 13.38Q77.45 12.47 75.96 10.91L75.91 10.86L75.96 10.91Q72.25 10.13 69.66 8.76L69.52 8.63L69.67 8.77Q76.30 15.94 80.87 22.98L80.91 23.01L80.81 22.92Q76.41 31.20 70.66 37.78L70.63 37.75L70.61 37.73Q71.96 37.10 74.09 36.53L74.10 36.54L72.82 38.00L72.82 38.00Q72.83 38.01 71.49 39.34L71.56 39.41L71.40 39.24Q74.45 38.22 77.61 37.73L77.70 37.82L77.62 37.74Q81.58 33.17 84.17 28.41L84.17 28.41L84.33 28.57Q86.71 32.62 89.41 35.48Z\"/><path fill=\"#444\" d=\"M135.82 35.33L135.79 35.29L135.81 35.32Q131.77 35.58 130.78 33.26L130.84 33.31L130.90 33.38Q131.60 32.37 133.16 30.58L133.20 30.62L133.15 30.56Q133.65 32.59 136.66 32.70L136.73 32.77L136.68 32.72Q140.09 32.83 141.73 31.49L141.69 31.45L141.58 31.34Q143.01 29.76 142.93 27.06L143.01 27.14L143.00 27.13Q142.92 22.14 138.12 22.36L138.12 22.37L138.00 22.24Q135.25 22.47 133.50 23.72L133.42 23.64L133.09 23.46L132.86 23.31L132.92 23.37Q133.28 20.23 133.17 17.49L133.24 17.56L133.10 17.42Q133.05 14.85 132.70 11.54L132.67 11.51L132.69 11.53Q136.37 12.50 140.17 12.39L140.19 12.40L140.11 12.32Q144.02 12.35 147.60 11.09L147.49 10.99L146.95 12.54L146.97 12.56Q146.71 13.36 146.52 14.20L146.58 14.26L146.49 14.17Q143.41 15.24 139.52 15.24L139.54 15.26L139.50 15.22Q138.10 15.27 136.62 15.11L136.58 15.07L136.57 15.07Q136.53 15.79 136.19 20.24L136.21 20.27L136.10 20.15Q136.93 19.69 138.99 19.54L139.01 19.56L139.06 19.61Q142.74 19.79 144.18 21.46L144.22 21.50L144.14 21.42Q145.63 23.06 145.89 26.90L145.83 26.84L145.84 26.85Q146.07 30.99 144.85 33.01L144.89 33.05L144.86 33.03Q142.81 34.89 139.49 35.12L139.52 35.15L139.65 35.28Q138.58 35.27 135.92 35.43ZM142.00 37.75L141.97 37.71L141.88 37.62Q145.37 37.76 147.27 36.66L147.26 36.64L147.26 36.65Q148.18 35.05 148.18 32.96L148.32 33.10L148.33 33.11Q148.15 29.84 147.19 25.73L147.32 25.85L147.24 25.77Q146.95 24.11 145.73 22.70L145.79 22.76L145.80 22.81L145.42 22.36L145.15 22.24L145.10 22.19Q144.83 21.50 144.18 20.81L144.18 20.81L144.15 20.82L144.19 20.86Q142.64 19.15 138.94 19.15L138.92 19.13L138.79 19.27L138.68 19.15Q138.73 18.56 138.92 17.46L139.07 17.61L138.93 17.47Q143.94 17.60 147.97 15.96L148.08 16.07L148.09 16.08Q148.52 14.68 149.47 11.87L149.45 11.84L147.21 12.65L147.27 12.70Q147.64 11.55 148.13 10.41L148.22 10.49L148.09 10.37Q144.28 11.85 140.17 11.93L140.24 12.00L140.29 12.05Q136.13 12.12 132.18 11.01L132.22 11.06L132.11 10.94Q132.75 15.32 132.75 19.73L132.82 19.81L132.89 19.88Q132.80 21.69 132.69 23.59L132.67 23.57L132.75 23.66Q132.99 23.82 133.56 24.13L133.64 24.21L133.55 24.11Q133.85 23.84 134.50 23.50L134.58 23.59L134.53 23.53Q134.45 24.25 134.22 25.77L134.30 25.85L134.19 25.75Q134.63 25.96 135.05 26.18L135.11 26.24L135.02 26.16Q137.95 24.55 139.81 24.55L139.82 24.56L139.75 24.49Q141.00 24.40 142.18 25.05L142.32 25.19L142.24 25.12Q142.53 26.09 142.57 27.04L142.70 27.17L142.70 27.17Q142.72 29.70 141.69 30.81L141.72 30.84L141.70 30.82Q140.30 32.01 138.06 32.24L138.10 32.28L138.10 32.28Q137.05 32.26 136.36 32.18L136.39 32.21L136.47 32.28Q135.62 32.16 134.86 31.82L134.81 31.76L134.85 31.62L134.64 31.63L134.67 31.66Q133.81 31.11 133.28 29.78L133.34 29.84L133.43 29.93Q131.98 31.22 130.30 33.35L130.38 33.43L130.33 33.38Q130.75 34.14 131.58 35.09L131.52 35.03L131.42 34.93Q132.57 36.84 135.39 37.33L135.30 37.25L135.40 37.34Q136.57 37.57 141.94 37.68Z\"/></svg>";


        ResponseEntity<CaptchaResponse> response = restClient.get()
                .uri("https://hoadondientu.gdt.gov.vn:30000/captcha")
//                .uri("https://google.com")
                .retrieve()
                .toEntity(new ParameterizedTypeReference<CaptchaResponse>() {});

        CaptchaResponse captchaResponse = response.getBody();
        String captchaCode = captchaResponse.key();
        String captchaSvg = captchaResponse.content();

        System.out.println("Response: " + captchaResponse.content());

        String result = CaptchaSolver.solveCaptcha(captchaSvg);
        System.out.println("Result: " + result);
        System.out.println("Captcha code: " + captchaCode);
    }
}

record CaptchaResponse(String key, String content) {}